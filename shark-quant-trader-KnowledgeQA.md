# Shark Quant Trader - Knowledge Q&A

> **版本**: 1.0  
> **最后更新**: 2026-02-14  
> **问答数量**: 22  
> **目标读者**: AI工程背景、有技术分析基础、量化交易新手

---

## 目录

- [基础概念 (Q1-Q5)](#基础概念)
- [策略详解 (Q6-Q10)](#策略详解)
- [机器学习 (Q11-Q15)](#机器学习)
- [模型融合与部署 (Q16-Q18)](#模型融合与部署)
- [验证与监控 (Q19-Q20)](#验证与监控)
- [实盘与运维 (Q21-Q22)](#实盘与运维)

---

## 基础概念

### Q1: 什么是"量化交易"？和普通炒股有什么区别？

**A:** 量化交易就是用**数学模型和程序**替代人的主观判断来做投资决策。

| 普通交易 | 量化交易 |
|---------|---------|
| "我觉得这只股票要涨" | "过去60天涨幅 > 10% + 成交量放大 → 买入信号" |
| 情绪化、受恐惧/贪婪影响 | 严格按规则执行，无情绪干扰 |
| 手动操作，反应慢 | 程序自动执行，毫秒级响应 |
| 难以复盘、无法验证 | 可回测历史数据验证策略有效性 |

**本项目的核心理念**：用代码把投资逻辑"固化"，让机器24/7执行，人只负责监控和调参。

---

### Q2: 什么是"动量策略"（Momentum）？为什么它有效？

**A:** 动量策略的核心假设：**涨的东西会继续涨，跌的东西会继续跌**（至少短期内）。

```yaml
配置文件中：
momentum_lookback: 60  # 看过去60天的涨跌
```

**原理**：
- 如果一个资产过去60天涨了15%，说明市场正在认可它
- 这种趋势往往有"惯性"，不会突然反转
- 学术研究表明这在股票、期货、加密货币市场都存在

**类比**：就像一辆高速行驶的汽车，不会瞬间停下，总要滑行一段距离。

---

### Q3: 什么是"风险平价"（Risk Parity）？为什么不用等权重？

**A:** 这是本系统最核心的资产配置思想。

**问题**：如果你有 $100,000，买 50% 股票 + 50% 债券：
- 股票波动率 = 15%（年化）
- 债券波动率 = 5%

**看起来平衡，实际上呢？**
```
股票风险贡献 = 50% × 15% = 7.5%
债券风险贡献 = 50% × 5% = 2.5%
→ 股票贡献了 75% 的组合风险！
```

**风险平价的解决方案**：让每个资产贡献**相同的风险**：
```
目标：股票风险 = 债券风险
→ 股票权重 × 15% = 债券权重 × 5%
→ 股票 25%, 债券 75%
```

**配置文件中**：
```yaml
portfolio:
  target_volatility: 0.15  # 目标组合波动率15%
```

---

### Q4: 什么是 VIX？为什么要根据它调整策略？

**A:** VIX 是"恐慌指数"（Volatility Index），衡量市场预期的波动程度。

```yaml
vix:
  normal: 20      # VIX < 20: 市场平静，正常交易
  elevated: 30    # VIX 20-30: 有点紧张，减少信心
  extreme: 40     # VIX > 40: 恐慌模式，只允许减仓
```

**为什么重要？**
- VIX = 20：市场预期未来30天波动约 ±5.7%
- VIX = 40：市场预期未来30天波动约 ±11.4%

**类比**：VIX 就像天气预报的"风力等级"：
- 3级风：正常出海
- 6级风：谨慎航行
- 10级风：立即返港

---

### Q5: 4级风控体系是怎么设计的？

**A:** 这是本系统的"保命机制"，参考了对冲基金的风控实践。

```
组合从最高点下跌：

5%  → Level 1: 警报，提高入场门槛，禁止新增BTC
8%  → Level 2: 强制减仓25%，清空BTC，只许卖
12% → Level 3: 减仓50%，只持有黄金+国债
15% → Level 4: 紧急清仓，需要人工确认才能重启
```

**设计思路**：
1. **渐进式**：不是一刀切，而是随风险逐步加码
2. **BTC优先清**：加密货币波动最大，危机时最先抛
3. **保留最后5%**：Level 4 是 15%，不是 100%，给反弹留空间

**类比**：就像火灾报警系统：
- 烟雾 → 警报
- 小火 → 喷水
- 大火 → 疏散
- 失控 → 紧急撤离

---

## 策略详解

### Q6: 什么是"截面动量"？和普通动量有什么区别？

**A:** 

| 时序动量 (Phase 1) | 截面动量 (Phase 2) |
|-------------------|-------------------|
| "GLD 过去60天涨了，继续买GLD" | "15个资产里，谁涨得最猛，买谁" |
| 和自己比 | 和别人比 |
| 绝对收益 | 相对排名 |

**配置文件中**：
```yaml
momentum_cross_sectional:
  lookback_months: 12     # 看过去12个月
  skip_months: 1          # 跳过最近1个月（避免短期反转）
  top_pct: 0.30           # 买排名前30%的资产
```

**为什么跳过最近1个月？**
- 研究发现：短期内（1个月）有"均值回归"效应
- 涨太猛的容易回调，跌太狠的容易反弹
- 所以用"12-1"月动量，避开这个陷阱

---

### Q7: "加密货币套利"（Crypto Carry）是什么逻辑？

**A:** 这是利用 BTC 永续合约的"资金费率"赚钱。

**背景知识**：
- 永续合约没有到期日，为了让价格贴近现货，交易所设计了"资金费率"
- 每8小时，多头和空头之间互相付费
- 如果资金费率 = +0.01%，意味着做多的人每8小时要付给做空的人 0.01%

**套利策略**：
```
当资金费率很高（比如 +0.03%/8h = 年化 ~32%）时：
1. 买入 1 BTC 现货
2. 做空 1 BTC 永续合约
3. 价格涨跌你都不亏（因为一个赚一个亏）
4. 但你每8小时白拿 0.03% 的资金费率！
```

**配置文件中**：
```yaml
carry:
  entry_rate_8h: 0.0001   # 0.01%/8h (~10%年化) 才入场
  max_position: 0.10       # 最多占组合10%（有对手方风险）
```

**风险**：交易所跑路、费率反转、价差异常

---

### Q8: 机器学习在这里起什么作用？为什么权重上限是50%？

**A:** ML 是"增强器"，不是"替代者"。

**传统因子的问题**：
- 动量、波动率这些因子很稳定，但收益有上限
- 它们无法捕捉非线性关系

**ML的价值**：
- 发现因子之间的复杂组合效应
- 例如："高动量 + 低波动 + 利率下行" 的三重信号比单个因子更强

**为什么上限50%？**
```yaml
fusion:
  ml_max_weight: 0.50        # ML最多50%
  traditional_min_weight: 0.50
```

**原因**：
1. **过拟合风险**：ML模型可能"记住"历史而非"学会"规律
2. **黑箱风险**：ML预测错了你不知道为什么
3. **稳健性**：传统因子历史验证过，ML还需要时间证明

**类比**：就像GPS导航 + 人类直觉，只用GPS可能把你带进河里。

---

### Q9: NLP情绪分析能带来什么优势？

**A:** 捕捉"市场情绪"这个传统数据看不到的维度。

**两个数据源**：

1. **新闻情绪 (FinBERT)**
```yaml
news:
  model_name: "ProsusAI/finbert"  # 金融领域专用BERT
  sentiment_momentum_window: 5    # 5天情绪趋势
```
- 分析财经新闻标题，判断正面/负面/中性
- 5天移动平均，捕捉情绪变化趋势

2. **COT持仓报告 (逆向指标)**
```yaml
cot:
  bullish_threshold: 0.90  # >90%时反向操作
  bearish_threshold: 0.10
```
- CFTC每周公布期货市场的多空持仓
- 当散户极度看多（>90%），往往是顶部
- 当散户极度看空（<10%），往往是底部
- **逆向思维**：大众错误时就是你的机会

---

### Q10: 这个系统最大的技术挑战是什么？

**A:** 三大挑战：

1. **数据泄露防止**
```yaml
purge_gap: 21  # 训练/测试之间隔21天
```
- ML模型很容易"偷看"未来数据导致虚假好成绩
- 解决方案：严格的时间隔离

2. **过拟合检测**
```yaml
retrain_trigger_ic: 0.02   # IC < 0.02 触发重训练
drift_ks_retrain: 0.20     # KS检验 > 0.2 说明模型失效
```
- 用 IC (Information Coefficient) 监控预测能力
- 用 KS 检验监控特征分布漂移

3. **系统稳定性**
- 数据源可能宕机 → 自动降级
- 模型可能失效 → 自动退化到传统策略
- 市场可能闪崩 → 4级风控保命

---

## 机器学习

### Q11: 什么是 IC (Information Coefficient)？为什么低于 0.02 要重训练？

**A:** IC 是衡量模型预测能力的核心指标。

**定义**：
```
IC = corr(模型预测值, 实际未来收益)
```

- **IC = 1**: 完美预测，每次都对
- **IC = 0**: 随机猜测，毫无预测力
- **IC = -1**: 完美反向预测，每次都错

**为什么用 IC 而不是准确率？**

| 准确率 | IC |
|-------|-----|
| "预测明天涨跌" → 对/错 | "预测收益排名" → 连续值 |
| 只关心方向 | 关心相对强弱 |
| 噪声大（市场随机波动） | 更稳定、更敏感 |

**实际例子**：假设你有 4 只股票，模型预测明天收益排名：

| 股票 | 模型预测排名 | 实际收益排名 |
|-----|------------|------------|
| A   | 1 (最高)   | 2          |
| B   | 2          | 1          |
| C   | 3          | 4          |
| D   | 4 (最低)   | 3          |

```
IC = corr([1,2,3,4], [2,1,4,3]) = 0.6  # 还不错！
```

**配置含义**：
```yaml
retrain_trigger_ic: 0.02
```

| IC 范围 | 含义 | 系统行为 |
|--------|------|---------|
| > 0.05 | 强预测力 | 正常使用 |
| 0.02-0.05 | 弱预测力 | 监控，准备重训练 |
| < 0.02 | 几乎无预测力 | **触发重训练** |
| < 0 | 反向预测 | 考虑停用模型 |

**为什么 0.02 是阈值？**
- 交易成本约 0.1-0.2%
- IC = 0.02 意味着模型只能解释 0.04% 的方差（R² ≈ IC²）
- 扣除成本后，收益可能为负
- 所以低于这个值，模型已经"不赚钱"了

---

### Q12: 什么是 KS 检验？为什么 > 0.2 说明模型失效？

**A:** KS 检验检测**数据分布是否发生变化**——这是"概念漂移"的信号。

**核心思想**：机器学习模型假设：**训练数据的分布 = 未来数据的分布**

但现实：
- 2020年疫情 → 市场波动模式剧变
- 2022年加息 → 成长股/价值股关系反转
- 这些变化模型没见过，就会失效

**KS 检验原理**：
```
比较两个分布：
- 分布 A：模型训练时的特征分布（历史）
- 分布 B：最近20天的特征分布（现在）

KS 统计量 = 两个分布的最大差异点
```

```
KS = 0    → 分布完全相同 ✅
KS = 0.1  → 轻微漂移 ⚠️
KS = 0.2  → 显著漂移 🚨 触发重训练
KS = 0.5  → 完全不同 💥 模型可能完全失效
```

**直观理解**：想象你在教小孩识别"猫"：
- 训练时：都是家猫照片
- 现在：来了老虎、狮子照片
- KS 检验发现"分布变了"，提醒你该更新教材了

**配置含义**：
```yaml
drift_ks_alert: 0.10       # 黄色警报：监控加强
drift_ks_retrain: 0.20     # 红色警报：立即重训练
```

**为什么和 IC 一起用？**

| 指标 | 检测什么 | 响应速度 |
|-----|---------|---------|
| IC | 预测能力衰减 | 慢（需要看实际收益） |
| KS | 数据分布漂移 | 快（实时检测特征） |

**组合使用**：
- KS 先报警（预警系统）
- IC 后验证（确认失效）

---

### Q13-Q15: 保留用于未来扩展

---

## 模型融合与部署

### Q16: 怎么选择最优的 purge_gap 天数？

**A:** Purge Gap 是防止"数据泄露"的关键参数——太短会泄露，太长会浪费数据。

**为什么需要 Purge Gap？**
```
时间线：
Day 1    Day 5    Day 10   Day 15   Day 20   Day 25
  |-----训练数据-----|-----Gap-----|-----测试数据-----|
```

**问题**：假设你用 Day 1-10 的数据训练，预测 Day 11 的收益
- 但 Day 10 的特征（如20日均线）其实包含了 Day 11 的部分信息
- 这就是"标签泄露"——模型偷看了答案

**选择原则**：
```yaml
purge_gap: 21  # 本项目选择21个交易日（约1个月）
```

**决定因素**：

| 因素 | 影响 | 本项目考量 |
|-----|------|-----------|
| 最长特征回看期 | 回看期越长，Gap越大 | SMA_200 → 但我们预测的是短期 |
| 预测目标周期 | 预测越远，Gap越大 | 预测5-20天收益 |
| 标签计算方式 | 前向标签需要更大Gap | 用未来5天收益做标签 |

**计算公式**：
```
Purge Gap ≥ max(标签前向天数, 最长相关特征回看期 × 衰减系数)
```

**本项目**：
- 标签前向天数 = 5-20天
- 相关特征：主要用 5/10/20/60天特征（非200天）
- Purge Gap = 21天 ✅

**经验法则**：

| 策略类型 | 推荐 Purge Gap |
|---------|---------------|
| 日内高频 | 1-5天 |
| 短期趋势（本项目）| **21天** |
| 中期轮动 | 42-63天 |
| 长期价值 | 126天+ |

**验证方法：检测泄露**
```python
# 如果训练IC远高于测试IC，可能有泄露
train_ic = 0.15  # 训练集 IC
test_ic = 0.02   # 测试集 IC
gap = train_ic - test_ic  # = 0.13

if gap > 0.05:  # 差距过大 → 可能泄露
    print("警告：尝试增加 purge_gap")
```

---

### Q17: 多个模型（XGBoost, LightGBM, Ridge）怎么融合？

**A:** 这是本系统的"集成学习"策略——用多个模型互相弥补弱点。

**为什么要融合？**

| 模型 | 优势 | 劣势 |
|-----|------|------|
| XGBoost | 捕捉非线性、交互效应 | 容易过拟合、黑箱 |
| LightGBM | 速度快、内存效率高 | 对噪声敏感 |
| Ridge | 稳定、可解释、线性 | 无法捕捉非线性 |

**融合逻辑**：牛市时树模型强，震荡时线性模型稳

**三种融合方法**：

#### 方法1: 简单平均（Baseline）
```python
final_signal = (xgb_pred + lgb_pred + ridge_pred) / 3
```

#### 方法2: 加权平均（本项目采用）
```yaml
fusion:
  ml_max_weight: 0.50
  rolling_window: 20  # 用过去20天表现动态调权重
```

```python
def calculate_model_weights(recent_performance):
    """根据近期表现动态分配权重"""
    total_ic = sum(recent_performance.values())
    weights = {
        model: ic / total_ic 
        for model, ic in recent_performance.items()
    }
    return weights

# 例如：
# XGBoost 近20天 IC = 0.05 → 50%
# LightGBM 近20天 IC = 0.03 → 30%
# Ridge 近20天 IC = 0.02 → 20%
```

#### 方法3: Stacking（高级）
```
Input Features → [XGBoost, LightGBM, Ridge] → Meta Model (Ridge) → Final
```

**分歧处理**：
```yaml
disagreement_threshold: 0.30  # 模型分歧 > 30% 时特殊处理
```

---

### Q18: 实盘部署时有哪些"坑"？

**A:** 五大关键坑点：

#### 坑1: 数据延迟与缺失
```yaml
data:
  primary: "polygon"
  fallback: "yfinance"
  btc_primary: "binance"
```
- yfinance 周末/假日返回空数据
- Polygon 免费版有15分钟延迟

#### 坑2: 滑点与执行差异
```yaml
costs:
  etf:
    slippage: 0.0005   # 0.05%
  btc:
    slippage: 0.0015   # 0.15%
```

#### 坑3: 状态一致性
- 订单发出但未确认时崩溃
- 本地状态 vs 券商状态不同步

#### 坑4: 时区与假日
- 美股: UTC-5/UTC-4
- 加密货币: 24/7
- 夏令时切换

#### 坑5: 风控失效
```
多层防护：
├── 券商端止损（硬止损 -20%）
├── 应用层风控（4级分层）
└── 仓位限制（事前控制）
```

---

## 验证与监控

### Q19: 如何设计纸盘交易验证流程？

**A:** 三阶段验证流程：

```
Stage 1: 系统稳定性 (Week 1-2)
├── 数据源连接稳定 > 99.9%
├── 信号按时生成 < 30分钟延迟
├── 模拟订单执行成功率 > 99%
└── 告警系统正常

Stage 2: 策略一致性 (Week 3-6)
├── 信号与回测逻辑一致
├── 仓位计算正确
├── 纸盘 vs 回测偏差 < 5%
└── 模型 IC 与预期一致

Stage 3: 绩效验证 (Week 7-12+)
├── 夏普比率 > 0.5
├── 最大回撤 < 15%
├── 胜率 > 48%
└── 所有风控级别至少触发过一次
```

**通过标准**：
```yaml
paper_trading:
  min_duration_days: 63        # 至少3个月
  min_sharpe: 0.5
  max_drawdown: 0.15
  max_deviation_from_backtest: 0.02
```

---

### Q20: 怎么监控模型的实时表现？

**A:** 两层监控架构：

#### Layer 1: 系统健康
```python
METRICS = {
    "api_latency_ms": {"warning": 1000, "critical": 5000},
    "data_staleness_minutes": {"warning": 30, "critical": 60},
    "memory_usage_pct": {"warning": 80, "critical": 95},
    "error_rate_1h": {"warning": 0.01, "critical": 0.05}
}
```

#### Layer 2: 模型质量
```python
def update(self, date, predictions, actuals, features):
    # 1. 计算当日 IC
    daily_ic = np.corrcoef(predictions, actuals)[0, 1]
    
    # 2. 计算 Rolling IC (20天)
    rolling_ic = np.mean([x["ic"] for x in self.ic_history[-20:]])
    
    # 3. 计算 KS 漂移
    ks_stat = self.calculate_feature_drift(features)
    
    # 4. 生成告警
    if rolling_ic < 0.02:
        alert("Rolling IC低于阈值，考虑重训练")
    if ks_stat > 0.2:
        alert("特征漂移严重，建议立即重训练")
```

**日报模板**：
```
═══════════════════════════════════════════════════
           Shark Quant Trader - 日报
═══════════════════════════════════════════════════

📊 今日表现
├── 组合收益: +0.42%
├── 基准 (SPY): +0.31%
└── 超额收益: +0.11%

🤖 模型状态
├── Rolling IC (20d): 0.034 ✅
├── KS统计量: 0.08 ✅
└── 特征覆盖率: 100%

⚠️ 风控状态
├── 当前级别: Level 0 (正常)
└── 组合相关性: 0.45 (正常)
```

---

## 实盘与运维

### Q21: 如何从纸盘过渡到实盘的具体步骤？

**A:** 渐进式上线：

```
资金比例:  0%  ────  10%  ────  25%  ────  50%  ────  100%
时间跨度: 3个月      4周        2周        2周        持续
```

#### Stage 0: 纸盘验证通过
```
✅ 运行时长 ≥ 63个交易日
✅ 夏普比率 > 0.5
✅ 最大回撤 < 15%
✅ 与回测偏差 < 2%
```

#### Stage 1: 小资金试运行 (10%, Week 1-4)
- 开设独立交易账户
- 设置券商端硬止损 (-20%)
- 首笔交易 ≤ $500
- 每日对账

#### Stage 2: 放大至 25% (Week 5-6)
- 4周无系统故障
- 实盘 vs 纸盘偏差 < 2%

#### Stage 3: 放大至 50% (Week 7-8)
- 累计收益为正（或回撤 < 5%）
- 至少经历过 1 次市场波动事件

#### Stage 4: 全量运行 (Week 9+)
- 4周无重大异常
- 风控系统至少触发过 1 次

**回滚机制**：
- 单日亏损 > 3% → 评估问题
- 累计回撤 > 10% → 回到上一阶段
- 系统故障 > 2 次 → 回到纸盘

---

### Q22: 长期运营的维护计划？

**A:** 分层维护体系：

#### 日常维护 (Daily)
- 数据质量检查
- 信号核验
- 对账
- 告警响应

#### 周期性任务 (Weekly/Monthly)
```
每周：
├── 绩效回顾
├── 模型评估
├── 市场环境分析
└── 系统运维

每月：
├── 模型重训练
├── 绩效深度分析
├── 参数校准
└── 文档更新
```

#### 季度/年度任务
```
季度：
├── 策略有效性分析
├── 架构评估
└── 下季度目标

年度：
├── Q1: 稳定优化
├── Q2: 功能增强
├── Q3: 策略扩展
└── Q4: 年度回顾
```

#### 版本管理
```
版本号: MAJOR.MINOR.PATCH

MAJOR: 策略重大变更
MINOR: 功能增强
PATCH: Bug修复、参数调整

示例: v1.0.0 → v1.1.0 → v1.1.1 → v2.0.0
```

#### 应急响应分级

| 级别 | 定义 | 响应时间 |
|-----|------|---------|
| P0 | 系统完全不可用 | 15分钟 |
| P1 | 核心功能异常 | 1小时 |
| P2 | 非核心功能异常 | 4小时 |
| P3 | 小问题/优化建议 | 1周 |

---

## 附录

### A. 配置文件参考
- `config/strategy.yaml` - 主策略配置

### B. 关键指标阈值速查

| 指标 | 正常 | 警告 | 危险 |
|-----|------|------|------|
| IC | > 0.03 | 0.02-0.03 | < 0.02 |
| KS | < 0.1 | 0.1-0.2 | > 0.2 |
| 回撤 | < 5% | 5-12% | > 12% |
| VIX | < 20 | 20-30 | > 40 |

### C. 相关文档
- PRD_Intelligent_Trading_System_v2.md
- Tech_Design_Document.md
- INVESTOR_PITCH.md

---

*最后更新: 2026-02-14*
*下一个问题编号: Q23*
